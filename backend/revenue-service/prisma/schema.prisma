// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Model สำหรับเก็บข้อมูลไฟล์ DBF
model File {
  id          String   @id @default(cuid())
  filename    String   // ชื่อไฟล์ที่บันทึกในระบบ
  originalName String  // ชื่อไฟล์ต้นฉบับ
  size        Int      // ขนาดไฟล์ (bytes)
  status      String   @default("uploaded") // uploaded, processing, completed, error
  fileType    String?  // ADP, OPD, CHT, CHA, INS, DRU
  schema      String?  // JSON string ของ schema
  userId      String   // ID ของผู้ใช้
  userName    String   // ชื่อผู้ใช้
  ipAddress   String?  // IP address ของผู้ใช้
  filePath    String?  // Path ของไฟล์ในระบบ
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  records Record[]
  schemas Schema[]
  processingLogs ProcessingLog[]
  exportLogs ExportLog[]

  @@index([userId])
  @@index([fileType])
  @@index([status])
}

// Model สำหรับเก็บข้อมูล Records จากไฟล์ DBF
model Record {
  id        String   @id @default(cuid())
  fileId    String   // ID ของไฟล์
  rowIndex  Int      // ลำดับของ record
  data      String   // JSON string ของข้อมูล record
  createdAt DateTime @default(now())

  // Relations
  file File @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@index([fileId])
  @@index([rowIndex])
}

// Model สำหรับเก็บข้อมูล Schema ของไฟล์ DBF
model Schema {
  id        String   @id @default(cuid())
  fileId    String   // ID ของไฟล์
  fieldName String   // ชื่อฟิลด์
  fieldType String   // ประเภทฟิลด์ (C, N, D, L, M)
  fieldLength Int    // ความยาวฟิลด์
  fieldDecimal Int   // จำนวนทศนิยม
  fieldOffset Int    // ตำแหน่งเริ่มต้นของฟิลด์
  createdAt DateTime @default(now())

  // Relations
  file File @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@index([fileId])
  @@index([fieldName])
}

// Model สำหรับเก็บข้อมูลการประมวลผล
model ProcessingLog {
  id              String   @id @default(cuid())
  fileId          String   // ID ของไฟล์
  processType     String   // batch, individual, linked
  processDetails  String?  // รายละเอียดการประมวลผล
  recordCount     Int      // จำนวน records ที่ประมวลผล
  processingTime  Int      // เวลาที่ใช้ในการประมวลผล (ms)
  status          String   @default("processing") // processing, completed, error
  errorMessage    String?  // ข้อความ error (ถ้ามี)
  userId          String   // ID ของผู้ใช้
  userName        String   // ชื่อผู้ใช้
  createdAt       DateTime @default(now())

  // Relations
  file File @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@index([fileId])
  @@index([status])
  @@index([userId])
}

// Model สำหรับเก็บข้อมูลการ Export
model ExportLog {
  id            String   @id @default(cuid())
  fileId        String   // ID ของไฟล์
  exportType    String   // DBF, CSV, JSON, Excel
  exportFormat  String?  // รูปแบบการ export
  recordCount   Int      // จำนวน records ที่ export
  fileSize      Int      // ขนาดไฟล์ที่ export (bytes)
  downloadPath  String?  // Path ของไฟล์ที่ export
  userId        String   // ID ของผู้ใช้
  userName      String   // ชื่อผู้ใช้
  createdAt     DateTime @default(now())

  // Relations
  file File @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@index([fileId])
  @@index([exportType])
  @@index([userId])
} 