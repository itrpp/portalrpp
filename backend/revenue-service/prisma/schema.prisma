// ========================================
// REVENUE SERVICE PRISMA SCHEMA
// ========================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ========================================
// UPLOAD RECORDS
// ========================================

model UploadRecord {
  id          String   @id @default(cuid())
  filename    String
  originalName String
  fileType    FileType
  fileSize    Int
  filePath    String
  uploadDate  DateTime @default(now())
  processedAt DateTime?
  status      UploadStatus @default(PENDING)
  userId      String?
  ipAddress   String?
  userAgent   String?
  
  // Validation results
  isValid     Boolean?
  errors      String? // JSON string of errors
  warnings    String? // JSON string of warnings
  
  // Processing results
  totalRecords    Int?
  validRecords    Int?
  invalidRecords  Int?
  processedRecords Int?
  skippedRecords  Int?
  processingTime   Int? // milliseconds
  
  // Metadata
  metadata    String? // JSON string of additional data
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  processingHistory ProcessingHistory[]
  
  @@map("upload_records")
}

// ========================================
// PROCESSING HISTORY
// ========================================

model ProcessingHistory {
  id          String   @id @default(cuid())
  uploadId    String
  upload      UploadRecord @relation(fields: [uploadId], references: [id], onDelete: Cascade)
  
  action      ProcessingAction
  status      ProcessingStatus
  message     String?
  
  // Processing details
  startTime   DateTime @default(now())
  endTime     DateTime?
  duration    Int? // milliseconds
  
  // Error details
  error       String?
  stackTrace  String?
  
  createdAt   DateTime @default(now())
  
  @@map("processing_history")
}

// ========================================
// STATISTICS
// ========================================

model UploadStatistics {
  id          String   @id @default(cuid())
  date        DateTime @unique // Date only (YYYY-MM-DD)
  
  // Upload counts
  totalUploads     Int @default(0)
  successfulUploads Int @default(0)
  failedUploads    Int @default(0)
  
  // File type breakdown
  dbfUploads       Int @default(0)
  repUploads       Int @default(0)
  stmUploads       Int @default(0)
  
  // File size statistics
  totalFileSize    Int @default(0) // bytes
  averageFileSize  Int @default(0) // bytes
  
  // Processing statistics
  totalProcessingTime Int @default(0) // milliseconds
  averageProcessingTime Int @default(0) // milliseconds
  
  // Records statistics
  totalRecords     Int @default(0)
  validRecords     Int @default(0)
  invalidRecords   Int @default(0)
  
  updatedAt        DateTime @updatedAt
  
  @@map("upload_statistics")
}

// ========================================
// SYSTEM CONFIGURATION
// ========================================

model SystemConfig {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("system_config")
}

// ========================================
// ENUMS
// ========================================

enum FileType {
  DBF
  REP
  STM
}

enum UploadStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  VALIDATION_FAILED
}

enum ProcessingAction {
  VALIDATE
  PROCESS
  BACKUP
  CLEANUP
}

enum ProcessingStatus {
  STARTED
  COMPLETED
  FAILED
  CANCELLED
} 