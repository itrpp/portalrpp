// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

/// ========================================
/// Porter Request Database Schema
/// ========================================

model PorterRequest {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Requester Information
  requesterDepartment String
  requesterName       String
  requesterPhone      String @db.VarChar(20)

  /// Patient Information
  patientName     String
  patientHN       String @db.VarChar(50)
  patientCondition Json?

  /// Pickup Location
  pickupBuildingId         String
  pickupFloorDepartmentId  String
  pickupRoomBedName        String?

  /// Delivery Location
  deliveryBuildingId         String
  deliveryFloorDepartmentId  String
  deliveryRoomBedName        String?

  /// Transport Meta
  requestedDateTime DateTime
  urgencyLevel      String @db.VarChar(50)
  vehicleType       String @db.VarChar(50)
  hasVehicle        String @db.VarChar(50)
  returnTrip        String @db.VarChar(50)
  transportReason   String @db.VarChar(200)

  equipment Json
  equipmentOther String? @db.VarChar(200)

  specialNotes String? @db.Text

  status        String @default("WAITING") @db.VarChar(50)
  assignedToId  String?

  acceptedAt  DateTime?
  completedAt DateTime?
  cancelledAt DateTime?
  cancelledReason String? @db.Text

  pickupAt   DateTime?
  deliveryAt DateTime?
  returnAt   DateTime?

  @@index([status])
  @@index([urgencyLevel])
  @@index([requestedDateTime])
  @@index([createdAt])
  @@index([assignedToId])
}

/// ========================================
/// Location Settings Schema
/// ========================================
model Building {
  id        String   @id @default(cuid())
  name      String   @db.VarChar(200)
  floorCount Int?
  status    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  floors FloorDepartment[]

  @@index([name])
  @@index([status])
}

model FloorDepartment {
  id        String   @id @default(cuid())
  name      String   @db.VarChar(200)
  buildingId String
  floorNumber Int?
  status    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  departmentType Int?
  roomType Int?
  roomCount Int?
  bedCount  Int?

  building Building @relation(fields: [buildingId], references: [id], onDelete: Cascade)

  @@index([buildingId])
  @@index([departmentType])
  @@index([status])
}

/// ========================================
/// Employee Management Schema
/// ========================================
model EmploymentType {
  id        String   @id @default(cuid())
  name      String   @unique @db.VarChar(100)
  status    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  employees PorterEmployee[]

  @@index([name])
  @@index([status])
}

model Position {
  id        String   @id @default(cuid())
  name      String   @unique @db.VarChar(100)
  status    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  employees PorterEmployee[]

  @@index([name])
  @@index([status])
}

model PorterEmployee {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  citizenId  String @unique @db.VarChar(13)
  firstName  String @db.VarChar(100)
  lastName   String @db.VarChar(100)

  employmentTypeId String
  positionId       String

  status Boolean @default(true)

  employmentType EmploymentType @relation(fields: [employmentTypeId], references: [id], onDelete: Restrict)
  position       Position       @relation(fields: [positionId], references: [id], onDelete: Restrict)

  @@index([citizenId])
  @@index([status])
  @@index([employmentTypeId])
  @@index([positionId])
}
